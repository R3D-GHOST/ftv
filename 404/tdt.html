<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canales IPTV</title>
    <link href="https://vjs.zencdn.net/8.5.2/video-js.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #ffffff;
        }
        .menu nav {
            display: flex;
            justify-content: center center;
            text-align: center;
            align-items: center;
            justify-content: space-around;
        }

        .menu nav a {
            text-decoration: none;
            margin: 20px;
            color: white;
            transition: 400ms;
        }

        .menu nav a:hover {
            color: gold;
        }


        .channel-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px;
            justify-content: center;
        }
        .channel {
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 10px;
            width: 150px;
            margin: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
        }
        .channel:hover {
            transform: scale(1.1);
        }
        .channel img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .channel span {
            display: block;
            margin-top: 5px;
            font-size: 14px;
            color: #cccccc;
        }
        #player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            display: none;
            z-index: 1000;
        }
        video-js {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center; margin: 20px 0;"></h1>

    <div class="menu">
        <nav>
            <a href="tdt.html">TV</a>
            <a href="plutotv.html">PLUTO TV</a>
            <a href="rakuten.html">Rakuten</a>
            <a href="sport.html">Deportes</a>
            <a href="pluto.html">Extra</a>
        </nav>
    </div>

    <div class="channel-container" id="channel-container"></div>

    <div id="player-container">
        <video-js id="video-player" class="video-js vjs-default-skin" autoplay controls preload="auto">
            <source src="" type="application/x-mpegURL">
        </video-js>
    </div>

    <script src="https://vjs.zencdn.net/8.5.2/video.min.js"></script>
    <script>
        const m3u8Url = "https://r3d-ghost.github.io/ftv/404/tdt.m3u8";
        const playerContainer = document.getElementById("player-container");
        const videoPlayer = videojs("video-player", {
            autoplay: true,
            controls: true,
        });

        async function loadChannels() {
            try {
                const response = await fetch(m3u8Url);
                const m3u8Text = await response.text();
                const container = document.getElementById("channel-container");
                const channels = parseM3U8(m3u8Text);

                channels.forEach(channel => {
                    const div = document.createElement("div");
                    div.className = "channel";
                    div.innerHTML = `
                        <img src="${channel.logo || 'https://via.placeholder.com/150?text=Sin+Logo'}" alt="Logo del Canal">
                        <span>${channel.name}</span>
                    `;
                    div.onclick = () => playChannel(channel.url);
                    container.appendChild(div);
                });
            } catch (error) {
                console.error("Error al cargar la lista de canales:", error);
            }
        }

        function parseM3U8(data) {
            const lines = data.split("\n");
            const channels = [];
            let currentChannel = {};

            lines.forEach(line => {
                if (line.startsWith("#EXTINF:")) {
                    const match = line.match(/#EXTINF:-1.*,(.*)/);
                    currentChannel.name = match ? match[1].trim() : "Canal Desconocido";
                    const logoMatch = line.match(/tvg-logo="(.*?)"/);
                    currentChannel.logo = logoMatch ? logoMatch[1] : "";
                } else if (line.startsWith("http")) {
                    currentChannel.url = line.trim();
                    channels.push(currentChannel);
                    currentChannel = {};
                }
            });

            return channels;
        }

        async function playChannel(url) {
            // Configura la fuente del video.
            videoPlayer.src({ src: url, type: "application/x-mpegURL" });

            // Muestra el contenedor del reproductor.
            playerContainer.style.display = "block";

            // Activa pantalla completa.
            const playerElement = document.getElementById("player-container");
            try {
                await playerElement.requestFullscreen();
                videoPlayer.play();
            } catch (err) {
                console.error("Error al entrar en pantalla completa:", err);
            }

            // Detecta cambios en pantalla completa para cerrar el reproductor.
            document.addEventListener("fullscreenchange", handleFullscreenChange);
        }

        function handleFullscreenChange() {
            // Si salimos de pantalla completa, cierra el reproductor.
            if (!document.fullscreenElement) {
                closePlayer();
            }
        }

        function closePlayer() {
            videoPlayer.pause();
            videoPlayer.src({ src: "", type: "" });
            playerContainer.style.display = "none";

            // Elimina el evento de cambio de pantalla completa.
            document.removeEventListener("fullscreenchange", handleFullscreenChange);
        }

        loadChannels();
    </script>
</body>
</html>
