<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV List</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1b1b1b;
            color: #fff;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        h3 {
            margin-top: 20px;
            font-size: 24px;
            color: #f9a825;
        }

        /* Estilo del contenedor de canales y grupos */
        #channels {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            max-height: 300px; /* Limitar altura del contenedor */
            overflow-y: auto; /* Habilitar desplazamiento vertical */
        }

        /* Estilo de scrollbar minimalista */
        #channels::-webkit-scrollbar {
            width: 6px;
        }

        #channels::-webkit-scrollbar-thumb {
            background: #555; /* Color de la barra */
            border-radius: 3px;
        }

        #channels::-webkit-scrollbar-thumb:hover {
            background: #777; /* Color de la barra al pasar el mouse */
        }

        /* Estilos para los canales */
        .channel {
            display: inline-flex; /* Cambiado a inline-flex para mantenerlos en línea */
            align-items: center;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            width: auto; /* Ajustar el ancho automáticamente */
            cursor: pointer;
            transition: background-color 0.3s;
            background-color: #333;
            outline: none; /* Para enfoque visual */
        }

        .channel:hover, .channel:focus {
            background-color: #555;
        }

        .channel img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 15px;
            border-radius: 5px;
        }

        .channel div {
            font-size: 16px;
        }

        /* Estilos para los grupos en slider */
        #groups {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 10px;
            margin-bottom: 20px;
        }

        /* Estilo de scrollbar minimalista para grupos */
        #groups::-webkit-scrollbar {
            height: 6px;
        }

        #groups::-webkit-scrollbar-thumb {
            background: #555; /* Color de la barra */
            border-radius: 3px;
        }

        #groups::-webkit-scrollbar-thumb:hover {
            background: #777; /* Color de la barra al pasar el mouse */
        }

        .group {
            background-color: #f9a825;
            color: #1b1b1b;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            white-space: nowrap;
            outline: none; /* Para enfoque visual */
        }

        .group:hover, .group:focus {
            background-color: #ffcc00;
        }

        /* Estilos para el buscador */
        #search {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            border: 1px solid #555;
            border-radius: 5px;
            background-color: #222;
            color: #fff;
        }

        /* Estilos para el botón de cargar más */
        #loadMoreBtn {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #f9a825;
            color: #1b1b1b;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #loadMoreBtn:hover {
            background-color: #ffcc00;
        }

        /* Responsividad */
        @media (max-width: 768px) {
            #channels {
                flex-direction: column;
            }

            .channel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <input type="text" id="search" placeholder="Search for channels...">
    
    <h3>Groups/Sections</h3>
    <div id="groups"></div>

    <h3>Channels</h3>
    <div id="channels"></div>

    <button id="loadMoreBtn">Load More Channels</button>

    <script>
        // Variables globales
        let channels = [];
        let displayedChannels = [];
        let currentChannelIndex = 0;
        const channelsPerPage = 30;
        const channelContainer = document.getElementById('channels');
        const searchInput = document.getElementById('search');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const groupsContainer = document.getElementById('groups');
        let currentFocusIndex = 0; // Índice para controlar el enfoque de los canales

        // Detectar el sistema operativo
        const isAndroid = navigator.userAgent.toLowerCase().includes('android');

        // Cargar y procesar el archivo M3U8
        fetch('https://r3d-ghost.github.io/ftv/404/tv.m3u8')
            .then(response => response.text())
            .then(data => {
                parseM3U8(data);
                displayChannels();
                displayGroups();
                focusChannel(0); // Establecer el enfoque en el primer canal
            });

        // Función para parsear el archivo M3U8
        function parseM3U8(data) {
            const lines = data.split('\n');
            lines.forEach((line, index) => {
                if (line.startsWith('#EXTINF')) {
                    const channelInfo = parseChannelInfo(line);
                    const url = lines[index + 1];
                    channels.push({ ...channelInfo, url });
                }
            });
            displayedChannels = [...channels];  // Por defecto, muestra todos los canales
        }

        // Función para parsear la información del canal
        function parseChannelInfo(line) {
            const name = line.split(',')[1];
            const logo = line.includes('tvg-logo') ? line.split('tvg-logo="')[1].split('"')[0] : '';
            const group = line.includes('group-title') ? line.split('group-title="')[1].split('"')[0] : 'Others';
            return { name, logo, group };
        }

        // Mostrar los primeros canales
        function displayChannels() {
            const fragment = document.createDocumentFragment();
            const endIndex = Math.min(currentChannelIndex + channelsPerPage, displayedChannels.length);
            
            for (let i = currentChannelIndex; i < endIndex; i++) {
                const channel = displayedChannels[i];
                const div = document.createElement('div');
                div.className = 'channel';
                div.tabIndex = 0; // Hacer que el canal sea accesible con tabulador
                div.innerHTML = `<img src="${channel.logo}" alt="${channel.name}"> <div>${channel.name}</div>`;
                div.onclick = () => playChannel(channel.url);
                fragment.appendChild(div);
            }
            currentChannelIndex = endIndex;
            channelContainer.appendChild(fragment);

            if (currentChannelIndex >= displayedChannels.length) {
                loadMoreBtn.style.display = 'none';
            } else {
                loadMoreBtn.style.display = 'inline-block';
            }
        }

        // Mostrar los grupos como slider
        function displayGroups() {
            const groups = [...new Set(channels.map(channel => channel.group))];
            groups.forEach(group => {
                const div = document.createElement('div');
                div.className = 'group';
                div.tabIndex = 0; // Hacer que los grupos sean accesibles con tabulador
                div.innerHTML = group;
                div.onclick = () => filterByGroup(group);
                groupsContainer.appendChild(div);
            });
        }

        // Filtrar canales por grupo
        function filterByGroup(group) {
            currentChannelIndex = 0;
            channelContainer.innerHTML = '';
            displayedChannels = channels.filter(channel => channel.group === group);
            displayChannels();
        }

        // Filtrar canales por búsqueda
        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.toLowerCase();
            channelContainer.innerHTML = '';
            currentChannelIndex = 0;
            displayedChannels = channels.filter(channel => channel.name.toLowerCase().includes(searchTerm));
            displayChannels();
        });

        // Función para cargar más canales
        loadMoreBtn.onclick = displayChannels;

        // Reproducir canal usando el reproductor por defecto de Android
        function playChannel(url) {
            if (isAndroid) {
                const intent = `intent://${url}#Intent;scheme=http;package=com.android.videos;end`;
                window.open(intent, '_blank');
            } else {
                // Usar un iframe o el reproductor de su elección
                window.open(url, '_blank');
            }
        }

        // Función para enfocar el canal seleccionado
        function focusChannel(index) {
            const channels = document.querySelectorAll('.channel');
            if (channels.length > 0) {
                channels[currentFocusIndex]?.classList.remove('focused');
                currentFocusIndex = index;
                channels[currentFocusIndex]?.classList.add('focused');
                channels[currentFocusIndex]?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Navegación con teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowDown') {
                focusChannel((currentFocusIndex + 1) % displayedChannels.length);
            } else if (e.key === 'ArrowUp') {
                focusChannel((currentFocusIndex - 1 + displayedChannels.length) % displayedChannels.length);
            } else if (e.key === 'Enter') {
                playChannel(displayedChannels[currentFocusIndex].url);
            }
        });

    </script>
</body>
</html>
